<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snapshot de Startups</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .container {
      background-color: #ffffff;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      padding: 3rem;
      margin-top: 2rem;
      margin-bottom: 2rem;
    }
    h1 {
      color: #007bff;
      font-weight: 700;
      text-align: center;
      margin-bottom: 2.5rem;
    }
    .form-select {
      border-radius: 0.5rem;
      border-color: #ced4da;
    }
    .table-responsive {
      margin-top: 1.5rem;
    }
    .table thead th {
      background-color: #007bff;
      color: white;
      vertical-align: middle;
      padding: 0.75rem 1rem;
    }
    .table tbody tr {
      transition: all 0.2s ease-in-out;
    }
    .table tbody tr:hover {
      background-color: #e2f2ff;
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    .table tbody td {
      vertical-align: middle;
      padding: 0.75rem 1rem;
    }
    .btn-outline-primary {
      color: #007bff;
      border-color: #007bff;
      transition: all 0.2s ease-in-out;
    }
    .btn-outline-primary:hover {
      background-color: #007bff;
      color: white;
    }
    .modal-content {
      border-radius: 10px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }
    .modal-header {
      background-color: #007bff;
      color: white;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      border-bottom: none;
    }
    .modal-title {
      font-weight: 600;
    }
    .modal-body {
      padding: 2rem;
    }
    #modal-logo {
      border: 1px solid #dee2e6;
      padding: 5px;
      background-color: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    #modal-nombre {
      color: #343a40;
      font-size: 1.75rem;
      font-weight: 700;
    }
    #modal-sector {
      color: #6c757d;
      font-size: 0.95rem;
      font-weight: 500;
    }
    .modal-body p {
      margin-bottom: 0.75rem;
      line-height: 1.6;
    }
    .modal-body p strong {
      color: #343a40;
    }
    a {
      color: #007bff;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body class="bg-light">

<div class="container py-5">
  <h1 class="mb-4">ðŸ“Š Snapshot de Startups</h1>

  <div class="row mb-4 gx-3">
    <div class="col-md-6 mb-3 mb-md-0">
      <label for="filter-sector" class="form-label visually-hidden">Filtrar por sector</label>
      <select class="form-select form-select-lg" id="filter-sector">
        <option value="">Todos los Sectores</option>
        </select>
    </div>
    <div class="col-md-6">
      <label for="filter-stage" class="form-label visually-hidden">Filtrar por etapa</label>
      <select class="form-select form-select-lg" id="filter-stage">
        <option value="">Todas las Etapas</option>
        </select>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Nombre</th>
          <th>Sector</th>
          <th>Etapa</th>
          <th>Contacto</th>
          <th>Email</th>
          <th>Web</th>
          <th class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody id="startup-tbody">
        </tbody>
    </table>
  </div>
</div>

<div class="modal fade" id="detalleModal" tabindex="-1" aria-labelledby="detalleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="detalleModalLabel">Detalle de Startup</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="d-flex align-items-center mb-4">
          <img id="modal-logo" src="" class="me-4 rounded-circle" alt="Logo" width="120" height="120" style="object-fit: contain;"/>
          <div>
            <h5 id="modal-nombre" class="mb-0"></h5>
            <p class="text-muted mb-0" id="modal-sector"></p>
          </div>
        </div>
        <p><strong>DescripciÃ³n:</strong> <span id="modal-descripcion" class="text-break"></span></p>
        <p><strong>Premios:</strong> <span id="modal-awards" class="text-break"></span></p>
        <p><strong>Contacto Principal:</strong> <span id="modal-contacto"></span></p>
        <p><strong>Email:</strong> <a href="" id="modal-email" class="text-break"></a></p>
        <p><strong>Website:</strong> <a href="" id="modal-website" target="_blank" class="text-break"></a></p>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  let startupsData = [];

  // Cargar JSON y poblar tabla
  fetch('startups.json')
    .then(res => {
      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`);
      }
      return res.json();
    })
    .then(data => {
      startupsData = data;
      populateFilters(data);
      renderTable(data);
    })
    .catch(error => {
      console.error('Error fetching startup data:', error);
      document.getElementById('startup-tbody').innerHTML = '<tr><td colspan="7" class="text-center text-danger">Error al cargar los datos de las startups. Por favor, intÃ©ntelo de nuevo mÃ¡s tarde.</td></tr>';
    });

  function populateFilters(data) {
    const sectorSet = new Set();
    const stageSet = new Set();

    data.forEach(s => {
      if(s.sector) sectorSet.add(s.sector);
      if(s.stage) stageSet.add(s.stage);
    });

    const filterSector = document.getElementById('filter-sector');
    Array.from(sectorSet).sort().forEach(sec => {
      const option = document.createElement('option');
      option.value = sec;
      option.textContent = sec;
      filterSector.appendChild(option);
    });

    const filterStage = document.getElementById('filter-stage');
    Array.from(stageSet).sort().forEach(st => {
      const option = document.createElement('option');
      option.value = st;
      option.textContent = st;
      filterStage.appendChild(option);
    });
  }

  function renderTable(data) {
    const tbody = document.getElementById('startup-tbody');
    tbody.innerHTML = ''; // Clear existing rows

    if (data.length === 0) {
      tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No se encontraron startups con los filtros seleccionados.</td></tr>';
      return;
    }

    data.forEach(s => {
      const tr = document.createElement('tr');
      const contactInfo = s.contact ? `${s.contact} ${s.jobTitle ? `(${s.jobTitle})` : ''}` : '';
      const emailLink = s.email ? `<a href="mailto:${s.email}" class="text-primary">${s.email}</a>` : '';
      const websiteLink = s.website ? `<a href="${s.website}" target="_blank" class="text-primary">${s.website.replace(/(^\w+:|^)\/\//, '')}</a>` : ''; // Remove http/https for display

      tr.innerHTML = `
        <td>${s.company || 'N/A'}</td>
        <td>${s.sector || 'N/A'}</td>
        <td>${s.stage || 'N/A'}</td>
        <td>${contactInfo || 'N/A'}</td>
        <td>${emailLink || 'N/A'}</td>
        <td>${websiteLink || 'N/A'}</td>
        <td class="text-center">
          <button class="btn btn-sm btn-outline-primary ver-detalle" data-bs-toggle="modal" data-bs-target="#detalleModal"
            data-nombre="${s.company || ''}"
            data-sector="${s.sector || ''}"
            data-stage="${s.stage || ''}"
            data-descripcion="${s.description || 'No hay descripciÃ³n disponible.'}"
            data-awards="${s.awards || 'Sin premios registrados.'}"
            data-contacto="${contactInfo || 'N/A'}"
            data-email="${s.email || ''}"
            data-website="${s.website || ''}"
            data-logo="${s.logo || ''}"
          ><i class="fas fa-eye"></i> Ver</button>
        </td>
      `;
      tbody.appendChild(tr);
    });

    // Reassign event for modal after rendering new rows
    document.querySelectorAll('.ver-detalle').forEach(btn => {
      btn.addEventListener('click', () => {
        document.getElementById('modal-nombre').innerText = btn.getAttribute('data-nombre');
        document.getElementById('modal-sector').innerText = `${btn.getAttribute('data-sector')} Â· ${btn.getAttribute('data-stage')}`;
        document.getElementById('modal-logo').src = btn.getAttribute('data-logo') || 'https://via.placeholder.com/120?text=Sin+Logo';
        document.getElementById('modal-descripcion').innerText = btn.getAttribute('data-descripcion');
        document.getElementById('modal-awards').innerText = btn.getAttribute('data-awards');
        document.getElementById('modal-contacto').innerText = btn.getAttribute('data-contacto');
        
        const modalEmail = document.getElementById('modal-email');
        const emailAttr = btn.getAttribute('data-email');
        if (emailAttr) {
            modalEmail.href = `mailto:${emailAttr}`;
            modalEmail.textContent = emailAttr;
        } else {
            modalEmail.href = '#';
            modalEmail.textContent = 'N/A';
        }

        const modalWebsite = document.getElementById('modal-website');
        const websiteAttr = btn.getAttribute('data-website');
        if (websiteAttr) {
            modalWebsite.href = websiteAttr;
            modalWebsite.textContent = websiteAttr.replace(/(^\w+:|^)\/\//, ''); // Remove http/https for display
        } else {
            modalWebsite.href = '#';
            modalWebsite.textContent = 'N/A';
        }
      });
    });
  }

  // Filtrado simple
  document.getElementById('filter-sector').addEventListener('change', applyFilters);
  document.getElementById('filter-stage').addEventListener('change', applyFilters);

  function applyFilters() {
    const sectorVal = document.getElementById('filter-sector').value;
    const stageVal = document.getElementById('filter-stage').value;

    const filtered = startupsData.filter(s => {
      return (sectorVal === '' || s.sector === sectorVal)
          && (stageVal === '' || s.stage === stageVal);
    });

    renderTable(filtered);
  }
</script>

</body>
</html>